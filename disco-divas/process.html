<!DOCTYPE HTML>
<!--
	Helios by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
    <title>Disco Divas</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript>
        <link rel="stylesheet" href="assets/css/noscript.css" />
    </noscript>
</head>

<body class="homepage is-preload">
    <div id="page-wrapper">


        <!-- Nav -->
        <nav id="nav">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li>
                    <a href="#">Subsystems</a>
                    <ul>
                        <li><a href="mech.html"">Mechanical</a></li>
                                    <li><a href=" elec.html">Electrical</a></li>
                        <li><a href="firm.html">Firmware</a></li>
                        <li><a href="soft.html">Software</a></li>
                    </ul>
                </li>
                <li><a href="process.html">Process</a></li>
                <li><a href="budget.html">Budget</a></li>
                <li><a href="team.html">The Team</a></li>
            </ul>
        </nav>

    </div>

    <!-- Banner -->
    <section id="banner">
        <header>
            <!-- <h2><strong>Electrical and Firmware Design</strong></h2> -->

        </header>
    </section>

    <!-- Main -->
    <div class="wrapper style2">

        <article id="main" class="container special">
            <a href="#" class="image featured"><img src="images/pic06.jpg" alt="" /></a>
            <header>
                <h2><a href="#">Our Process</a></h2>

            </header>

    <p>
    We completed this project in three two-week long sprints. Here’s what we did in each one!
    </p>
    <p>
        <br>
    </p>
    <head>
        <style>
        * {
          box-sizing: border-box;
        }
        
        .column {
          float: left;
          width: 33.33%;
          padding: 5px;
        }
        
        /* Clearfix (clear floats) */
        .row::after {
          content: "";
          clear: both;
          display: table;
        }
        </style>
        </head>
        <body>

        <div class="row">
          <div class="column">
            <img src="images/S1-Image.png" alt="Snow" style="width:100%">
          </div>
          <div class="column">
            <img src="images/S1-Image.png" alt="Forest" style="width:100%">
          </div>
          <div class="column">
            <img src="images/S1-Image.png" alt="Mountains" style="width:100%">
          </div>
        </div>
        <p>
        </p>

        </body>
        </html>

    <p id="sprint1">
    <strong></id><span style="text-decoration:underline;">Sprint 1 </span></strong>
    </p>
    <p>
    <strong>Sprint 1 Deliverables:</strong>
    </p>
    <p>
    Mechanical: 
    </p>
    <ul>
    
    <li>Create a spinning disk, an arm that holds one pen (stationary), and a box to house all components.
    
    <li>Start thinking about & designing pen-moving linear mechanism
    </li>
    </ul>
    <p>
    Software: 
    </p>
    <ul>
    
    <li>Figure out libraries that deal with audio processing. 
    
    <li>Create graphs of frequencies or some other breakdown of music
    </li>
    </ul>
    <p>
    Electrical/Firmware:
    </p>
    <ul>
    
    <li>Spin the turntable
    </li>
    </ul>
    <p>
    <strong>Mechanical Design:</strong>
    </p>
    <p>
    For our first sprint, our main objective was rotating the turntable. To do this, we laser cut a small gear to put on the motor shaft. We laser cut teeth onto the edges of the disk so it could mesh with the small gear, creating a 12:1 gear ratio. This large gear ratio along with a slow spinning DC motor allowed us to spin the disk sufficiently slowly that it would complete only one rotation over the length of one song. 
    </p>
    <p>
    <p>
    Initial CAD
    </p>
    <p>
        <a href="#" class="image featured"><img src="images/S1-CAD.png" alt="" /></a>

    </p>
    </p>
    <p>
    We created the structure for our first prototype out of ⅛” hardboard and added a structure to hold a pen. 
    </p>
    <p>
    Sprint 1 Prototype
    </p>
    <p>
        <img src="images/S1-Image.png" alt="" />

    </p>


    <p>
    <strong>Electrical/Firmware:</strong>
    </p>
    <ul>
    
    <li>Researched motors
    
    <li>Testing
    
    <li>Created a circuit for DC motor
    </li>
    </ul>
    <p>
    <strong>Software:</strong>
    </p>
    <p>
    Going into the first sprint, we had a lot of uncertainty about how difficult the kind of audio analysis we were trying to do would be. This sprint involved a lot of researching and trying out different audio processing libraries. The goal was to start by breaking the song up into different frequencies. The visuals below, called chromagraphs, were generated by using the library Librosa. At the end of the project, we only ended up using Librosa to load the song, which was not strictly necessary (so we didn’t end up using many of the features of the library at the end of the day).
    </p>
    <p>
        <figure>
            <img src="images/chromagraph_1.png" alt="">
            <img src="images/chromagraph_2.png" alt="">
            <figcaption>Fig. chromagraphs</figcaption>
        </figure>
    </p>
    <p>
    <strong><span style="text-decoration:underline;">Sprint 2:</span></strong>
    </p>
    <p>
    <strong>Sprint 2 Goals:</strong>
    </p>
    <p>
    Electrical/firmware:
    </p>
    <ul>
    
    <li>Spin the stepper motors that move the pens back and forth while the disk is spinning
    </li>
    </ul>
    <p>
    Software: 
    </p>
    <ul>
    
    <li>Create customized frequency-splitting workflow and visualization
    </li>
    </ul>
    <p>
    Mechanical: 
    </p>
    <ul>
    
    <li>Design and build a system to move the pens back and forth as the disk spins
    </li>
    </ul>
    <p>
    <strong>Mechanical Design</strong>
    </p>
    <p>
    <span style="text-decoration:underline;">Lead Screws</span>
    </p>
    <p>
    Developing a mechanism to move the pens back and forth was our main objective for this sprint. After investigating many linear motion mechanisms, we decided to use a lead screw because it would be easy to control, precise, sturdy, and relatively inexpensive. Additionally, COTS lead screws and lead screw nuts seemed reliable and easily purchased, leaving fewer unknowns in our design. 
    </p>
    <p>
    [img9]
    </p>
    <p>
    <span style="text-decoration:underline;">Vertical Design</span>
    </p>
    <p>
    You can learn more about our lead screw mechanism in our *mechanical design description* When designing the linear motion mechanism, we hoped to use as few components as we could and make our system as compact as possible. Because of these goals, we chose to connect each of our three Nema 17 Stepper Motors directly to the lead screw using a shaft coupler and stack the three identical mechanisms vertically. This also allowed us to keep the three pens aligned along the radius of the circle. 
    </p>
    <p>
    [img10]
    </p>
    <p>
    <span style="text-decoration:underline;">End Plate Mounting:</span>
    </p>
    <p>
    Our second mechanical design challenge in Sprint 2 was supporting the end plate in a way that was both secure and allowed us to easily remove and replace the piece of paper on our disk. 
    </p>
    <p>
    [img11]
    </p>
    <p>
    After considering options where the end plate connected through the center of the disk and box, we decided to create a bar going across the top of the disk secured on either side of the box. Although it isn’t particularly compact, it accomplished both of our objectives. For Sprint 2, we created this bar out of three pieces of ⅛” hardboard and connected the ¼” MDF end plate to it using a custom sheet metal bracket. 
    </p>
    <p>
    <span style="text-decoration:underline;">Sprint 2 CAD:</span>
    </p>
    <p>
    [img12]
    </p>
    <p>
    <span style="text-decoration:underline;">Disk:</span>
    </p>
    <p>
    Finally, we purchased a 16 tooth gear and recut our disk out of ¼” red acrylic with smaller teeth to mesh with it. This helped reduce some of the gear backlash and allowed our disk to spin more smoothly and precisely. 
    </p>
    <p>
    [img13]
    </p>
    <p>
    Sprint 2 video:
    </p>
    <p>
    <a href="https://drive.google.com/file/d/1ssM6Dv0d9QHcO1LsWVNEJxu5UoXcUVqX/view?resourcekey">https://drive.google.com/file/d/1ssM6Dv0d9QHcO1LsWVNEJxu5UoXcUVqX/view?resourcekey</a> 
    </p>
    <p>
    <strong>Electrical Design:</strong>
    </p>
    <p>
    <strong>Firmware Design:</strong>
    </p>
    <p>
    <strong>Software Design:</strong>
    </p>
    <p>
    The goal with this sprint was to get to an MVP level visual, where the frequencies were split up and represented with their changes over time.
    </p>
    <p>
    One of the first steps was getting the frequency data over the course of the song. To do this, we ended up using a Fast Fourier transform to separate the frequencies, rather than using an audio processing library, because that ended up being more complicated.
    </p>
    <p>
        <figure>
            <img src="images/all_freq_data.png" alt="">
            <figcaption>Fig. "all_freq_data" Dataframe</figcaption>
        </figure>
    </p>
    <p>
    We ended up with a dataframe with frequencies in the rows and time samples (in ms) in each column. The value in each cell corresponds to the volume of that signal. A few key observations are that the values go from 0 to -100, where 0 is the loudest and -100 is no audio signal. 
    </p>
    <p>
    The next step was to split it into three buckets, bass, mid, and treble. However, we found that the borderline between those categories was different with each song, based on how many frequencies comprised it. We ended up using a logarithmic scale to split the buckets. We then used a weighted average (that took a bit of tuning) to come up with the volume over time of each bucket. Visualized in a graph, it looks like this: 
    </p>
    <p>
        <figure>
            <img src="images/frequency_plot_1.png" alt="">
            <figcaption>Fig. frequency plot over time</figcaption>
        </figure>
    </p>
    <p>
    Unfortunately, all three buckets looked pretty similar. We also tried a percussion/harmonic split, which was a bit better. This is the same song but with the percussion removed: 
    </p>
    <p>
        <figure>
            <img src="images/frequency_plot_2.png" alt="">
            <figcaption>Fig. frequency plot over time without percussion</figcaption>
        </figure>
    </p>
    <p>
    However, that’s not really what we wanted either. We decided to leave the percussion in and see what it looked like in the circular representation we wanted. 
    </p>
    <p>
        <figure>
            <img src="images/circular_visual_1.png" alt="">
            <img src="images/circular_visual_2.png" alt="">
            <figcaption>Fig. first iteration of circular visual</figcaption>
        </figure>
    </p>
    <p>
    They’re pretty basic and not that interesting to look at, but they captured the information we wanted to include, so they were a good start. 
    </p>
    <p>
    We then worked on creating a CSV to hold the positions we wanted each motor to be at at a given time, so that we could package the data from the visualizations into something that firmware could use. The CSV ended up looking something like this:
    </p>
    <p>
        <figure>
            <img src="images/position_csv.png" alt="">
            <figcaption>Fig. position CSV to pass to firmware</figcaption>
        </figure>
    </p>
    <p>
    We were able to pass that to firmware for testing.
    </p>
    <p>
    <strong><span style="text-decoration:underline;">Sprint 3:</span></strong>
    </p>
    <p>
    <strong>Sprint 3 Goals:</strong>
    </p>
    <p>
    Hit our MVP - creating a record player-like machine, where one rotation of the machine corresponds to the length of the song. While the machine rotates, 3 pens will shift back and forth to draw the intensity of various frequency bands. The resulting image is 3 concentric “circles”, with oscillations varying in intensity.
    </p>
    <p>
    Mechanical: 
    </p>
    <ul>
    
    <li>Remake final structure out of stronger materials
    
    <li>Small optimizations and redesigns based on testing
    </li>
    </ul>
    <p>
    Electrical/Firmware:
    </p>
    <ul>
    
    <li>Move all motors to draw <em>something</em> from the music
    
    <li>Fully tie together mechanical and software; debug calibration issues
    </li>
    </ul>
    <p>
    Software: 
    </p>
    <ul>
    
    <li>Continue making the visualization more meaningful
    
    <li>Scaling, adding in oscillations, trying out different songs and making small optimizations
    </li>
    </ul>
    <p>
    <strong>Mechanical Design:</strong>
    </p>
    <p>
    [img19]
    </p>
    <p>
    [img20]
    </p>
    <p>
    The mechanical design changes in sprint 3 included remaking the pen mounts to make them more sturdy, remaking the box out of ¼” plywood, and and 
    </p>
    <p>
    <strong>Software Design</strong>
    </p>
    <p>
    One big goal was to continue making the visualizations better. We decided to add in oscillations to capture the feel of music a bit more and ended up with something like this:
    </p>
    <p>
    [img21]
    </p>
    <p>
    This is much more dynamic, and we liked it a lot better. One important learning was that the sampling rate matters a lot, because it affects the density of the points. For example, the same song at different sampling rates:
    </p>
    <p>
    [img22]
    </p>
    <p>
    Clearly, the one on the right is much more realistic for our physical system to draw.
    </p>
    <p>
    We then tried putting in some different songs with different sounds, and got the following results (along with the previous two).
    </p>
    <p>
    [img23]
    </p>
    <p>
    Unfortunately, all the songs ended up looking pretty similar. We tried a couple things, like scaling things up to take more of the circle, but it didn’t change the visualizations too much. We also noticed that all four songs had a weird spike at the beginning/end, which we thought should not be the case. 
    </p>
    <p>
    After the 3rd sprint, we had a little more time to improve the visualization. We got rid of the spike at the beginning by trimming the quiet parts of the song at the beginning and the end. We also pulled the -100 values up to -80 or so. Those two things were throwing off the scaling, because they were throwing off the average volumes. They made the visualizations a lot better. We also tried a classical song (because while all the songs we tried had different sounds, they’re all a little more similar to each other than they are to the classical song).
    </p>
    <p>
    [img24]
    </p>
            <!-- everything else in main text goes here-->
        </article>

    </div>

    <!-- Footer -->
    <div id="footer">
        <div class="container">

            <div class="row">
                <div class="col-12">

                    <!-- Copyright -->
                    <div class="copyright">
                        <ul class="menu">
                            <li></li>
                            <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
                        </ul>
                    </div>

                </div>

            </div>
        </div>
    </div>

    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.dropotron.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

</body>

</html>